<!DOCTYPE html>
<html>
<head>
  <title>360° Gallery and 3D Objects</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    
    .ui-overlay {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px 0;
      z-index: 1000;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    
    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    button {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    button:hover {
      background: #2a6abf;
    }
    
    .info-display {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <div id="info" class="info-display">
    <h3>360° Gallery</h3>
    <p>Use WASD keys to move and mouse to look around.</p>
  </div>
  
  <div class="ui-overlay">
    <div class="nav-buttons">
      <button id="prev-btn">Previous</button>
      <button id="toggle-btn">Switch to 3D Objects</button>
      <button id="next-btn">Next</button>
    </div>
  </div>
  
  <a-scene loading-screen="enabled: true">
    <!-- Assets preload -->
    <a-assets timeout="30000">
      <!-- More reliable 360° panorama images -->
      <img id="beach-360" src="https://threejs.org/examples/textures/2294472375_24a3b8ef46_o.jpg" crossorigin="anonymous">

      <!-- Mountain 360° panorama -->
      <img id="mountain-360" src="https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg" crossorigin="anonymous">

      <!-- For 360° video -->
      <video id="tour-360" src="https://threejs.org/examples/textures/pano.webm" autoplay="false" loop crossorigin="anonymous"></video>
    </a-assets>
    
    <!-- Camera rig -->
    <a-entity position="0 1.6 0">
      <a-camera look-controls wasd-controls="acceleration: 100"></a-camera>
    </a-entity>
    
    <!-- Panorama Environments -->
    <a-entity id="panorama-container">
      <!-- Environment 1: Beach 360° Image -->
      <a-entity id="env1" visible="true">
        <a-sky src="#beach-360" rotation="0 -90 0"></a-sky>
      </a-entity>
      
      <!-- Environment 2: Mountain 360° Image -->
      <a-entity id="env2" visible="false">
        <a-sky src="#mountain-360" rotation="0 -90 0"></a-sky>
      </a-entity>
      
      <!-- Environment 3: 360° Video -->
      <a-entity id="env3" visible="false">
        <a-videosphere src="#tour-360" rotation="0 -90 0"></a-videosphere>
      </a-entity>
    </a-entity>
    
    <!-- 3D Model Display -->
    <a-entity id="models-container" visible="false">
      <!-- Simple environment background for models -->
      <a-sky color="#ECECEC"></a-sky>
      
      <!-- Model showcase area with different primitive shapes acting as "models" -->
      <a-entity id="model1" visible="true">
        <a-box position="0 1.5 -3" width="2" height="2" depth="2" color="#F44336" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"></a-box>
      </a-entity>
      
      <a-entity id="model2" visible="false">
        <a-tetrahedron position="0 1.5 -3" radius="1.5" color="#2196F3" animation="property: rotation; to: 360 360 0; loop: true; dur: 10000; easing: linear"></a-tetrahedron>
      </a-entity>
      
      <a-entity id="model3" visible="false">
        <a-dodecahedron position="0 1.5 -3" radius="1.3" color="#4CAF50" animation="property: rotation; to: 360 0 360; loop: true; dur: 10000; easing: linear"></a-dodecahedron>
      </a-entity>
    </a-entity>
  </a-scene>
  
  <script>
    // Wait for A-Frame to fully initialize
    document.querySelector('a-scene').addEventListener('loaded', function() {
      console.log('A-Frame scene has loaded!');
      
      // Add asset load error handling
      const assetItems = document.querySelectorAll('a-assets img, a-assets video');
      assetItems.forEach(item => {
        item.addEventListener('error', function(e) {
          console.error('Failed to load asset:', item.id, item.getAttribute('src'));
        });
        console.log('Asset registered for loading:', item.id);
      });
      
      // DOM elements
      const infoDisplay = document.getElementById('info');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const toggleBtn = document.getElementById('toggle-btn');
      
      // Environment control elements
      const panoramaContainer = document.getElementById('panorama-container');
      const modelsContainer = document.getElementById('models-container');
      const env1 = document.getElementById('env1');
      const env2 = document.getElementById('env2');
      const env3 = document.getElementById('env3');
      const model1 = document.getElementById('model1');
      const model2 = document.getElementById('model2');
      const model3 = document.getElementById('model3');
      
      // Get 360 video element
      const videoAsset = document.getElementById('tour-360');
      
      // State tracking
      let currentMode = 'panorama'; // 'panorama' or 'model'
      let currentPanorama = 0;
      let currentModel = 0;
      
      const panoramas = [
        { el: env1, title: 'Beach 360° View', description: 'A beautiful beach panoramic view in full 360 degrees.' },
        { el: env2, title: 'Mountain Landscape', description: 'A breathtaking mountain 360° panorama for an immersive experience.' },
        { el: env3, title: '360° Video Tour', description: 'An immersive 360° video environment that surrounds you completely.' }
      ];
      
      const models = [
        { el: model1, title: 'Cube', description: 'A simple rotating cube model.' },
        { el: model2, title: 'Tetrahedron', description: 'A four-sided pyramid shape model.' },
        { el: model3, title: 'Dodecahedron', description: 'A complex 12-faced polyhedron model.' }
      ];
      
      // Update the info display
      function updateInfo() {
        const current = currentMode === 'panorama' 
          ? panoramas[currentPanorama] 
          : models[currentModel];
        
        infoDisplay.innerHTML = `
          <h3>${current.title}</h3>
          <p>${current.description}</p>
          <p>Mode: ${currentMode === 'panorama' ? '360° Environment' : '3D Object'}</p>
          <p>Use WASD keys to move and mouse to look around.</p>
        `;
      }
      
      // Handle 360 video
      function handleVideo(shouldPlay) {
        if (videoAsset) {
          if (shouldPlay) {
            videoAsset.play().catch(e => console.log("Video play error:", e));
          } else {
            videoAsset.pause();
          }
        }
      }
      
      // Show the current panorama
      function showPanorama() {
        // Pause video first (will start if needed)
        handleVideo(false);
        
        // Hide all panoramas
        for (let i = 0; i < panoramas.length; i++) {
          panoramas[i].el.setAttribute('visible', i === currentPanorama);
        }
        
        // Play video if the current environment is the video one
        if (currentPanorama === 2) {
          handleVideo(true);
        }
        
        // Log current panorama for debugging
        console.log('Switched to panorama:', currentPanorama, panoramas[currentPanorama].title);
        
        updateInfo();
      }
      
      // Show the current model
      function showModel() {
        // Hide all models
        for (let i = 0; i < models.length; i++) {
          models[i].el.setAttribute('visible', i === currentModel);
        }
        updateInfo();
      }
      
      // Toggle between panorama and model views
      function toggleView() {
        if (currentMode === 'panorama') {
          // Switch to model mode
          currentMode = 'model';
          toggleBtn.textContent = 'Switch to 360° Views';
          panoramaContainer.setAttribute('visible', 'false');
          modelsContainer.setAttribute('visible', 'true');
          
          // Pause any playing videos
          handleVideo(false);
          
          showModel();
        } else {
          // Switch to panorama mode
          currentMode = 'panorama';
          toggleBtn.textContent = 'Switch to 3D Objects';
          panoramaContainer.setAttribute('visible', 'true');
          modelsContainer.setAttribute('visible', 'false');
          showPanorama();
        }
      }
      
      // Handle button clicks
      prevBtn.addEventListener('click', function() {
        console.log('Previous button clicked in mode:', currentMode);
        if (currentMode === 'panorama') {
          currentPanorama = (currentPanorama - 1 + panoramas.length) % panoramas.length;
          showPanorama();
        } else {
          currentModel = (currentModel - 1 + models.length) % models.length;
          showModel();
        }
      });
      
      nextBtn.addEventListener('click', function() {
        console.log('Next button clicked in mode:', currentMode);
        if (currentMode === 'panorama') {
          currentPanorama = (currentPanorama + 1) % panoramas.length;
          showPanorama();
        } else {
          currentModel = (currentModel + 1) % models.length;
          showModel();
        }
      });
      
      toggleBtn.addEventListener('click', toggleView);
      
      // Initialize the scene
      console.log("Initializing the first panorama view");
      showPanorama();
    });
  </script>
</body>
</html>